@using DndShared.Models

<div class="card shadow-sm">
    <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">
            <i class="bi bi-list-check me-2"></i>
            Skill Proficiencies
        </h5>
    </div>
    <div class="card-body">
        <p class="text-muted mb-3">Select proficiency level for each skill.</p>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label"><strong>Acrobatics</strong> <small class="text-muted">(DEX)</small></label>
                <select class="form-select" @bind="skills.Acrobatics" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Animal Handling</strong> <small class="text-muted">(WIS)</small></label>
                <select class="form-select" @bind="skills.AnimalHandling" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Arcana</strong> <small class="text-muted">(INT)</small></label>
                <select class="form-select" @bind="skills.Arcana" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Athletics</strong> <small class="text-muted">(STR)</small></label>
                <select class="form-select" @bind="skills.Athletics" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Deception</strong> <small class="text-muted">(CHA)</small></label>
                <select class="form-select" @bind="skills.Deception" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>History</strong> <small class="text-muted">(INT)</small></label>
                <select class="form-select" @bind="skills.History" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Insight</strong> <small class="text-muted">(WIS)</small></label>
                <select class="form-select" @bind="skills.Insight" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Intimidation</strong> <small class="text-muted">(CHA)</small></label>
                <select class="form-select" @bind="skills.Intimidation" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Investigation</strong> <small class="text-muted">(INT)</small></label>
                <select class="form-select" @bind="skills.Investigation" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Medicine</strong> <small class="text-muted">(WIS)</small></label>
                <select class="form-select" @bind="skills.Medicine" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Nature</strong> <small class="text-muted">(INT)</small></label>
                <select class="form-select" @bind="skills.Nature" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Perception</strong> <small class="text-muted">(WIS)</small></label>
                <select class="form-select" @bind="skills.Perception" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Performance</strong> <small class="text-muted">(CHA)</small></label>
                <select class="form-select" @bind="skills.Performance" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Persuasion</strong> <small class="text-muted">(CHA)</small></label>
                <select class="form-select" @bind="skills.Persuasion" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Religion</strong> <small class="text-muted">(INT)</small></label>
                <select class="form-select" @bind="skills.Religion" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Sleight of Hand</strong> <small class="text-muted">(DEX)</small></label>
                <select class="form-select" @bind="skills.SleightOfHand" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Stealth</strong> <small class="text-muted">(DEX)</small></label>
                <select class="form-select" @bind="skills.Stealth" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label"><strong>Survival</strong> <small class="text-muted">(WIS)</small></label>
                <select class="form-select" @bind="skills.Survival" @bind:after="ValidateAndNotify">
                    <option value="@SkillProficiency.None">None</option>
                    <option value="@SkillProficiency.Proficiency">Proficiency</option>
                    <option value="@SkillProficiency.Expertise">Expertise</option>
                </select>
            </div>
        </div>
    </div>
</div>

@code {
    private CharacterSkills skills = new();

    [Parameter]
    public CharacterSkills? Skills { get; set; }

    [Parameter]
    public EventCallback<CharacterSkills> OnSkillsChanged { get; set; }

    [Parameter]
    public EventCallback<bool> OnValidationChanged { get; set; }

    public bool IsValid => true; // Skills are always optional

    protected override void OnParametersSet()
    {
        if (Skills != null)
        {
            skills = Skills;
        }
    }

    private async Task ValidateAndNotify()
    {
        await OnSkillsChanged.InvokeAsync(skills);
        await OnValidationChanged.InvokeAsync(IsValid);
    }
}
